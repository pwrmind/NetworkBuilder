<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Brain.js ML Constructor</title>
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Alpine.js -->
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
    
    <!-- D3.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/7.9.0/d3.min.js"></script>
    
    <!-- Brain.js -->
    <script src="https://cdn.jsdelivr.net/npm/brain.js@2.0.0-beta.21/browser.js"></script>
    
    <style>
        :root {
            --primary-color: #4361ee;
            --secondary-color: #3f37c9;
            --accent-color: #4895ef;
            --light-color: #f8f9fa;
            --dark-color: #212529;
            --success-color: #4cc9f0;
            --warning-color: #f72585;
        }
        
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f5f7fb;
            color: var(--dark-color);
        }
        
        .sidebar {
            background: linear-gradient(180deg, var(--primary-color) 0%, var(--secondary-color) 100%);
            color: white;
            min-height: 100vh;
            box-shadow: 0 0 15px rgba(0, 0, 0, 0.1);
        }
        
        .nav-link {
            color: rgba(255, 255, 255, 0.85);
            padding: 0.75rem 1rem;
            margin: 0.25rem 0;
            border-radius: 0.375rem;
            transition: all 0.2s;
        }
        
        .nav-link:hover, .nav-link.active {
            background-color: rgba(255, 255, 255, 0.15);
            color: white;
        }
        
        .nav-link i {
            width: 1.5rem;
            text-align: center;
        }
        
        .main-content {
            padding: 1.5rem;
        }
        
        .card {
            border: none;
            border-radius: 0.75rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
            margin-bottom: 1.5rem;
        }
        
        .card-header {
            background-color: white;
            border-bottom: 1px solid #e9ecef;
            font-weight: 600;
            padding: 1rem 1.25rem;
            border-radius: 0.75rem 0.75rem 0 0 !important;
        }
        
        .btn-primary {
            background-color: var(--primary-color);
            border-color: var(--primary-color);
        }
        
        .btn-primary:hover {
            background-color: var(--secondary-color);
            border-color: var(--secondary-color);
        }
        
        .form-control, .form-select {
            border-radius: 0.5rem;
            padding: 0.5rem 0.75rem;
            font-size: 0.875rem;
        }
        
        .form-label {
            font-weight: 500;
            margin-bottom: 0.5rem;
            font-size: 0.875rem;
        }
        
        .badge-network {
            background-color: var(--accent-color);
            color: white;
        }
        
        .training-graph {
            background-color: white;
            border-radius: 0.5rem;
            padding: 1rem;
        }
        
        .data-preview {
            max-height: 300px;
            overflow-y: auto;
            font-size: 0.75rem;
        }
        
        .model-visualization {
            background: linear-gradient(45deg, #f8f9fa, #e9ecef);
            border-radius: 0.5rem;
            padding: 1rem;
            min-height: 200px;
        }
        
        .neuron {
            display: inline-block;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background-color: var(--primary-color);
            margin: 5px;
            text-align: center;
            line-height: 30px;
            color: white;
            font-size: 0.7rem;
        }
        
        .layer {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin: 0 10px;
        }
        
        .progress {
            height: 0.5rem;
        }
        
        .step-indicator {
            display: flex;
            justify-content: space-between;
            margin-bottom: 2rem;
        }
        
        .step {
            text-align: center;
            flex: 1;
            position: relative;
        }
        
        .step:not(:last-child):after {
            content: '';
            position: absolute;
            top: 15px;
            left: 50%;
            width: 100%;
            height: 2px;
            background-color: #dee2e6;
            z-index: 1;
        }
        
        .step-number {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background-color: #dee2e6;
            color: #6c757d;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 0.5rem;
            z-index: 2;
            position: relative;
        }
        
        .step.active .step-number {
            background-color: var(--primary-color);
            color: white;
        }
        
        .step.completed .step-number {
            background-color: var(--success-color);
            color: white;
        }
        
        .step-title {
            font-size: 0.875rem;
            font-weight: 500;
        }
        
        .code-block {
            background-color: #2d3748;
            color: #e2e8f0;
            border-radius: 0.5rem;
            padding: 1rem;
            font-family: 'Courier New', monospace;
            font-size: 0.875rem;
            overflow-x: auto;
        }
        
        .network-type-card {
            cursor: pointer;
            transition: all 0.2s;
            border: 2px solid transparent;
        }
        
        .network-type-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.1);
        }
        
        .network-type-card.selected {
            border-color: var(--primary-color);
        }
        
        .table-sm {
            font-size: 0.75rem;
        }
    </style>
</head>
<body>
    <div x-data="mlApp()" x-init="init()">
        <!-- Header -->
        <header class="bg-white shadow-sm py-2">
            <div class="container-fluid">
                <div class="d-flex justify-content-between align-items-center">
                    <div class="d-flex align-items-center">
                        <i class="fas fa-brain text-primary fs-4 me-2"></i>
                        <h1 class="h4 mb-0 fw-bold">Brain.js ML Constructor</h1>
                    </div>
                    <div class="d-flex align-items-center">
                        <button class="btn btn-sm btn-outline-primary me-2" @click="resetApp()">
                            <i class="fas fa-redo me-1"></i> Сбросить
                        </button>
                        <div class="dropdown">
                            <button class="btn btn-sm btn-primary dropdown-toggle" type="button" data-bs-toggle="dropdown">
                                <i class="fas fa-download me-1"></i> Экспорт
                            </button>
                            <ul class="dropdown-menu dropdown-menu-end">
                                <li><a class="dropdown-item" href="#" @click="exportModel()"><i class="fas fa-file-code me-2"></i> Модель (JSON)</a></li>
                                <li><a class="dropdown-item" href="#" @click="exportCode()"><i class="fas fa-code me-2"></i> Код (JS)</a></li>
                                <li><a class="dropdown-item" href="#" @click="exportResults()"><i class="fas fa-chart-bar me-2"></i> Результаты</a></li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </header>

        <div class="container-fluid">
            <div class="row">
                <!-- Sidebar -->
                <div class="col-md-3 col-lg-2 sidebar p-0">
                    <div class="d-flex flex-column p-3">
                        <div class="step-indicator d-md-none mb-4">
                            <template x-for="(step, index) in steps" :key="index">
                                <div class="step" :class="{'active': currentStep === index, 'completed': currentStep > index}">
                                    <div class="step-number" x-text="index+1"></div>
                                    <div class="step-title" x-text="step.title"></div>
                                </div>
                            </template>
                        </div>
                        
                        <ul class="nav nav-pills flex-column mb-auto">
                            <template x-for="(step, index) in steps" :key="index">
                                <li class="nav-item">
                                    <a href="#" class="nav-link d-flex align-items-center" 
                                       :class="{'active': currentStep === index}"
                                       @click="currentStep = index">
                                        <i class="fas" :class="step.icon"></i>
                                        <span class="ms-2" x-text="step.title"></span>
                                    </a>
                                </li>
                            </template>
                        </ul>
                        
                        <div class="mt-auto pt-3 border-top">
                            <div class="d-flex align-items-center text-white">
                                <div>
                                    <h6 class="mb-0">Текущая модель</h6>
                                    <small x-text="selectedNetworkType.name || 'Не выбрана'" class="text-white-50"></small>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Main Content -->
                <div class="col-md-9 col-lg-10 main-content">
                    <!-- Step 1: Выбор типа сети -->
                    <div x-show="currentStep === 0">
                        <div class="d-flex justify-content-between align-items-center mb-4">
                            <h2 class="h4 mb-0">Выбор типа нейронной сети</h2>
                            <span class="badge bg-primary" x-text="`Шаг ${currentStep+1} из ${steps.length}`"></span>
                        </div>
                        
                        <div class="row">
                            <template x-for="network in networkTypes" :key="network.id">
                                <div class="col-md-6 col-lg-4 mb-3">
                                    <div class="card network-type-card h-100" 
                                         :class="{'selected': selectedNetworkType.id === network.id}"
                                         @click="selectNetworkType(network)">
                                        <div class="card-body">
                                            <div class="d-flex justify-content-between align-items-start mb-2">
                                                <h5 class="card-title" x-text="network.name"></h5>
                                                <i class="fas fa-check-circle text-primary" x-show="selectedNetworkType.id === network.id"></i>
                                            </div>
                                            <p class="card-text small" x-text="network.description"></p>
                                            <div class="mt-2">
                                                <span class="badge badge-network me-1" x-text="network.category"></span>
                                                <span class="badge bg-light text-dark" x-text="network.complexity"></span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </template>
                        </div>
                        
                        <div class="mt-4">
                            <div class="card">
                                <div class="card-header">
                                    <i class="fas fa-info-circle me-2"></i>Информация о выбранной сети
                                </div>
                                <div class="card-body">
                                    <template x-if="selectedNetworkType.id">
                                        <div>
                                            <h5 x-text="selectedNetworkType.name"></h5>
                                            <p x-text="selectedNetworkType.longDescription"></p>
                                            <div class="row">
                                                <div class="col-md-6">
                                                    <h6>Лучше всего подходит для:</h6>
                                                    <ul>
                                                        <template x-for="useCase in selectedNetworkType.useCases" :key="useCase">
                                                            <li x-text="useCase"></li>
                                                        </template>
                                                    </ul>
                                                </div>
                                                <div class="col-md-6">
                                                    <h6>Особенности:</h6>
                                                    <ul>
                                                        <template x-for="feature in selectedNetworkType.features" :key="feature">
                                                            <li x-text="feature"></li>
                                                        </template>
                                                    </ul>
                                                </div>
                                            </div>
                                        </div>
                                    </template>
                                    <template x-if="!selectedNetworkType.id">
                                        <p class="text-muted mb-0">Выберите тип нейронной сети для просмотра информации</p>
                                    </template>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Step 2: Конфигурация модели -->
                    <div x-show="currentStep === 1">
                        <div class="d-flex justify-content-between align-items-center mb-4">
                            <h2 class="h4 mb-0">Конфигурация модели</h2>
                            <span class="badge bg-primary" x-text="`Шаг ${currentStep+1} из ${steps.length}`"></span>
                        </div>
                        
                        <div class="row">
                            <div class="col-lg-8">
                                <div class="card mb-4">
                                    <div class="card-header">
                                        <i class="fas fa-sliders-h me-2"></i>Архитектура сети
                                    </div>
                                    <div class="card-body">
                                        <div class="model-visualization d-flex justify-content-center align-items-center mb-4">
                                            <div class="layer">
                                                <div class="fw-bold mb-2 text-center">Входной слой</div>
                                                <template x-for="i in parseInt(modelConfig.inputSize)" :key="i">
                                                    <div class="neuron" x-text="i"></div>
                                                </template>
                                            </div>
                                            
                                            <template x-for="(layer, layerIndex) in modelConfig.hiddenLayers" :key="layerIndex">
                                                <div class="d-flex align-items-center">
                                                    <i class="fas fa-arrow-right text-muted mx-2"></i>
                                                    <div class="layer">
                                                        <div class="fw-bold mb-2 text-center">Скрытый слой <span x-text="layerIndex+1"></span></div>
                                                        <template x-for="i in parseInt(layer)" :key="i">
                                                            <div class="neuron" x-text="i"></div>
                                                        </template>
                                                    </div>
                                                </div>
                                            </template>
                                            
                                            <div class="d-flex align-items-center">
                                                <i class="fas fa-arrow-right text-muted mx-2"></i>
                                                <div class="layer">
                                                    <div class="fw-bold mb-2 text-center">Выходной слой</div>
                                                    <template x-for="i in parseInt(modelConfig.outputSize)" :key="i">
                                                        <div class="neuron" x-text="i"></div>
                                                    </template>
                                                </div>
                                            </div>
                                        </div>
                                        
                                        <div class="row">
                                            <div class="col-md-4 mb-3">
                                                <label class="form-label">Размер входного слоя</label>
                                                <input type="number" class="form-control form-control-sm" min="1" max="100" 
                                                       x-model="modelConfig.inputSize">
                                            </div>
                                            <div class="col-md-4 mb-3">
                                                <label class="form-label">Размер выходного слоя</label>
                                                <input type="number" class="form-control form-control-sm" min="1" max="100" 
                                                       x-model="modelConfig.outputSize">
                                            </div>
                                            <div class="col-md-4 mb-3">
                                                <label class="form-label">Функция активации</label>
                                                <select class="form-select form-select-sm" x-model="modelConfig.activation">
                                                    <option value="sigmoid">Sigmoid</option>
                                                    <option value="relu">ReLU</option>
                                                    <option value="leaky-relu">Leaky ReLU</option>
                                                    <option value="tanh">Tanh</option>
                                                </select>
                                            </div>
                                        </div>
                                        
                                        <div class="mb-3">
                                            <div class="d-flex justify-content-between align-items-center mb-2">
                                                <label class="form-label mb-0">Скрытые слои</label>
                                                <div>
                                                    <button class="btn btn-sm btn-outline-primary me-1" @click="addHiddenLayer()">
                                                        <i class="fas fa-plus"></i>
                                                    </button>
                                                    <button class="btn btn-sm btn-outline-secondary" @click="removeHiddenLayer()" 
                                                            :disabled="modelConfig.hiddenLayers.length <= 1">
                                                        <i class="fas fa-minus"></i>
                                                    </button>
                                                </div>
                                            </div>
                                            <div class="row">
                                                <template x-for="(layer, index) in modelConfig.hiddenLayers" :key="index">
                                                    <div class="col-sm-6 col-md-4 mb-2">
                                                        <div class="input-group input-group-sm">
                                                            <span class="input-group-text">Слой <span x-text="index+1"></span></span>
                                                            <input type="number" class="form-control" min="1" max="100" 
                                                                   x-model="modelConfig.hiddenLayers[index]">
                                                        </div>
                                                    </div>
                                                </template>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="col-lg-4">
                                <div class="card mb-4">
                                    <div class="card-header">
                                        <i class="fas fa-cog me-2"></i>Гиперпараметры
                                    </div>
                                    <div class="card-body">
                                        <div class="mb-3">
                                            <label class="form-label">Скорость обучения</label>
                                            <input type="range" class="form-range" min="0.001" max="1" step="0.001" 
                                                   x-model="trainingConfig.learningRate">
                                            <div class="d-flex justify-content-between">
                                                <small>0.001</small>
                                                <small x-text="trainingConfig.learningRate"></small>
                                                <small>1.0</small>
                                            </div>
                                        </div>
                                        
                                        <div class="mb-3">
                                            <label class="form-label">Итерации</label>
                                            <input type="number" class="form-control form-control-sm" 
                                                   x-model="trainingConfig.iterations" min="100" max="50000">
                                        </div>
                                        
                                        <div class="mb-3">
                                            <label class="form-label">Порог ошибки</label>
                                            <input type="number" class="form-control form-control-sm" step="0.001"
                                                   x-model="trainingConfig.errorThresh" min="0.001" max="0.1">
                                        </div>
                                        
                                        <div class="mb-3">
                                            <label class="form-label">Momentum</label>
                                            <input type="range" class="form-range" min="0" max="1" step="0.01" 
                                                   x-model="trainingConfig.momentum">
                                            <div class="d-flex justify-content-between">
                                                <small>0</small>
                                                <small x-text="trainingConfig.momentum"></small>
                                                <small>1.0</small>
                                            </div>
                                        </div>
                                        
                                        <div class="form-check form-switch mb-3">
                                            <input class="form-check-input" type="checkbox" id="logTraining" x-model="trainingConfig.log">
                                            <label class="form-check-label" for="logTraining">Логирование процесса</label>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Step 3: Загрузка данных -->
                    <div x-show="currentStep === 2">
                        <div class="d-flex justify-content-between align-items-center mb-4">
                            <h2 class="h4 mb-0">Загрузка и подготовка данных</h2>
                            <span class="badge bg-primary" x-text="`Шаг ${currentStep+1} из ${steps.length}`"></span>
                        </div>
                        
                        <div class="row">
                            <div class="col-lg-6">
                                <div class="card mb-4">
                                    <div class="card-header">
                                        <i class="fas fa-upload me-2"></i>Загрузка данных
                                    </div>
                                    <div class="card-body">
                                        <div class="mb-3">
                                            <label class="form-label">Выберите источник данных</label>
                                            <div class="d-grid gap-2 d-md-block">
                                                <button class="btn btn-sm btn-outline-primary me-2" @click="showSampleData()">
                                                    <i class="fas fa-database me-1"></i> Пример данных
                                                </button>
                                                <button class="btn btn-sm btn-outline-primary" @click="$refs.fileInput.click()">
                                                    <i class="fas fa-file-upload me-1"></i> Загрузить файл
                                                </button>
                                                <input type="file" x-ref="fileInput" class="d-none" accept=".csv,.json" @change="handleFileUpload($event)">
                                            </div>
                                        </div>
                                        
                                        <div class="mb-3">
                                            <label class="form-label">Или введите данные вручную (JSON)</label>
                                            <textarea class="form-control" rows="5" x-model="manualDataInput" 
                                                      placeholder='[{"input": [0,0], "output": [0]}, {"input": [0,1], "output": [1]}]'></textarea>
                                        </div>
                                        
                                        <div class="d-flex justify-content-between">
                                            <button class="btn btn-sm btn-outline-secondary" @click="parseData()">
                                                <i class="fas fa-check me-1"></i> Применить данные
                                            </button>
                                            <button class="btn btn-sm btn-outline-primary" @click="preprocessData()" :disabled="!trainingData.length">
                                                <i class="fas fa-magic me-1"></i> Автоподготовка
                                            </button>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="card">
                                    <div class="card-header">
                                        <i class="fas fa-chart-pie me-2"></i>Статистика данных
                                    </div>
                                    <div class="card-body">
                                        <template x-if="trainingData.length">
                                            <div>
                                                <div class="row text-center">
                                                    <div class="col-4">
                                                        <div class="fw-bold text-primary" x-text="trainingData.length"></div>
                                                        <small class="text-muted">Всего записей</small>
                                                    </div>
                                                    <div class="col-4">
                                                        <div class="fw-bold text-success" x-text="Math.floor(trainingData.length * 0.7)"></div>
                                                        <small class="text-muted">Обучающая выборка (70%)</small>
                                                    </div>
                                                    <div class="col-4">
                                                        <div class="fw-bold text-warning" x-text="Math.ceil(trainingData.length * 0.3)"></div>
                                                        <small class="text-muted">Тестовая выборка (30%)</small>
                                                    </div>
                                                </div>
                                                
                                                <div class="mt-3">
                                                    <h6>Информация о входах:</h6>
                                                    <ul class="small">
                                                        <li>Количество признаков: <span x-text="getInputSize()"></span></li>
                                                        <li>Тип данных: <span x-text="getDataType()"></span></li>
                                                    </ul>
                                                </div>
                                                
                                                <div class="mt-2">
                                                    <h6>Информация о выходах:</h6>
                                                    <ul class="small">
                                                        <li>Количество классов: <span x-text="getOutputSize()"></span></li>
                                                        <li>Тип задачи: <span x-text="getProblemType()"></span></li>
                                                    </ul>
                                                </div>
                                            </div>
                                        </template>
                                        <template x-if="!trainingData.length">
                                            <p class="text-muted mb-0">Загрузите данные для просмотра статистики</p>
                                        </template>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="col-lg-6">
                                <div class="card h-100">
                                    <div class="card-header d-flex justify-content-between align-items-center">
                                        <span><i class="fas fa-table me-2"></i>Предпросмотр данных</span>
                                        <span class="badge bg-primary" x-text="`${trainingData.length} записей`"></span>
                                    </div>
                                    <div class="card-body p-0">
                                        <template x-if="trainingData.length">
                                            <div class="data-preview">
                                                <table class="table table-sm table-striped mb-0">
                                                    <thead class="table-light">
                                                        <tr>
                                                            <th>#</th>
                                                            <th>Input</th>
                                                            <th>Output</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody>
                                                        <template x-for="(item, index) in trainingData.slice(0, 20)" :key="index">
                                                            <tr>
                                                                <td x-text="index+1"></td>
                                                                <td>
                                                                    <span x-text="JSON.stringify(item.input)"></span>
                                                                </td>
                                                                <td>
                                                                    <span x-text="JSON.stringify(item.output)"></span>
                                                                </td>
                                                            </tr>
                                                        </template>
                                                        <tr x-show="trainingData.length > 20">
                                                            <td colspan="3" class="text-center text-muted py-2">
                                                                ... и еще <span x-text="trainingData.length - 20"></span> записей
                                                            </td>
                                                        </tr>
                                                    </tbody>
                                                </table>
                                            </div>
                                        </template>
                                        <template x-if="!trainingData.length">
                                            <div class="d-flex justify-content-center align-items-center p-5 text-muted">
                                                <div class="text-center">
                                                    <i class="fas fa-table fa-2x mb-3"></i>
                                                    <p>Нет данных для отображения</p>
                                                </div>
                                            </div>
                                        </template>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Step 4: Обучение модели -->
                    <div x-show="currentStep === 3">
                        <div class="d-flex justify-content-between align-items-center mb-4">
                            <h2 class="h4 mb-0">Обучение модели</h2>
                            <span class="badge bg-primary" x-text="`Шаг ${currentStep+1} из ${steps.length}`"></span>
                        </div>
                        
                        <div class="row">
                            <div class="col-lg-8">
                                <div class="card mb-4">
                                    <div class="card-header d-flex justify-content-between align-items-center">
                                        <span><i class="fas fa-chart-line me-2"></i>Процесс обучения</span>
                                        <div>
                                            <span class="badge me-2" :class="trainingStatus === 'training' ? 'bg-warning' : trainingStatus === 'completed' ? 'bg-success' : 'bg-secondary'"
                                                  x-text="trainingStatus === 'training' ? 'Обучается' : trainingStatus === 'completed' ? 'Завершено' : 'Не начато'"></span>
                                        </div>
                                    </div>
                                    <div class="card-body">
                                        <div class="training-graph mb-4">
                                            <div id="errorChart"></div>
                                        </div>
                                        
                                        <div class="row text-center mb-3">
                                            <div class="col-4">
                                                <div class="fw-bold" x-text="currentIteration"></div>
                                                <small class="text-muted">Текущая итерация</small>
                                            </div>
                                            <div class="col-4">
                                                <div class="fw-bold" x-text="currentError ? currentError.toFixed(6) : '0'"></div>
                                                <small class="text-muted">Текущая ошибка</small>
                                            </div>
                                            <div class="col-4">
                                                <div class="fw-bold" x-text="trainingTime ? `${trainingTime}s` : '0s'"></div>
                                                <small class="text-muted">Время обучения</small>
                                            </div>
                                        </div>
                                        
                                        <div class="progress mb-3" style="height: 8px;">
                                            <div class="progress-bar" role="progressbar" 
                                                 :style="`width: ${trainingProgress}%`"></div>
                                        </div>
                                        
                                        <div class="d-flex justify-content-between">
                                            <button class="btn btn-sm btn-success" @click="startTraining()" 
                                                    :disabled="trainingStatus === 'training' || !trainingData.length">
                                                <i class="fas fa-play me-1"></i> Начать обучение
                                            </button>
                                            <button class="btn btn-sm btn-warning" @click="pauseTraining()" 
                                                    :disabled="trainingStatus !== 'training'">
                                                <i class="fas fa-pause me-1"></i> Пауза
                                            </button>
                                            <button class="btn btn-sm btn-danger" @click="stopTraining()" 
                                                    :disabled="trainingStatus !== 'training'">
                                                <i class="fas fa-stop me-1"></i> Остановить
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="col-lg-4">
                                <div class="card mb-4">
                                    <div class="card-header">
                                        <i class="fas fa-info-circle me-2"></i>Информация о обучении
                                    </div>
                                    <div class="card-body">
                                        <template x-if="trainingResult">
                                            <div>
                                                <h6>Результаты обучения:</h6>
                                                <ul class="small">
                                                    <li>Итерации: <span x-text="trainingResult.iterations"></span></li>
                                                    <li>Ошибка: <span x-text="trainingResult.error.toFixed(6)"></span></li>
                                                    <li>Время: <span x-text="trainingResult.time"></span> сек</li>
                                                </ul>
                                            </div>
                                        </template>
                                        <template x-if="!trainingResult">
                                            <p class="text-muted mb-0">Обучение не проводилось</p>
                                        </template>
                                    </div>
                                </div>
                                
                                <div class="card">
                                    <div class="card-header">
                                        <i class="fas fa-terminal me-2"></i>Лог обучения
                                    </div>
                                    <div class="card-body p-0">
                                        <div class="data-preview">
                                            <template x-for="log in trainingLogs" :key="log.id">
                                                <div class="px-3 py-2 border-bottom">
                                                    <div class="small" x-text="log.message"></div>
                                                    <div class="text-muted extra-small" x-text="log.timestamp"></div>
                                                </div>
                                            </template>
                                            <div class="px-3 py-2 text-muted text-center" x-show="!trainingLogs.length">
                                                Лог пуст
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Step 5: Тестирование и результаты -->
                    <div x-show="currentStep === 4">
                        <div class="d-flex justify-content-between align-items-center mb-4">
                            <h2 class="h4 mb-0">Тестирование и результаты</h2>
                            <span class="badge bg-primary" x-text="`Шаг ${currentStep+1} из ${steps.length}`"></span>
                        </div>
                        
                        <div class="row">
                            <div class="col-lg-6">
                                <div class="card mb-4">
                                    <div class="card-header">
                                        <i class="fas fa-vial me-2"></i>Тестирование модели
                                    </div>
                                    <div class="card-body">
                                        <div class="mb-3">
                                            <label class="form-label">Входные данные для тестирования</label>
                                            <textarea class="form-control" rows="3" x-model="testInput" 
                                                      placeholder='[0, 1] или {"r": 0.5, "g": 0.2, "b": 0.8}'></textarea>
                                        </div>
                                        
                                        <div class="d-flex justify-content-between mb-3">
                                            <button class="btn btn-sm btn-primary" @click="runTest()" :disabled="!trainedModel">
                                                <i class="fas fa-bolt me-1"></i> Выполнить тест
                                            </button>
                                            <button class="btn btn-sm btn-outline-secondary" @click="loadExampleTest()">
                                                <i class="fas fa-download me-1"></i> Пример теста
                                            </button>
                                        </div>
                                        
                                        <div class="mb-3" x-show="testResult">
                                            <label class="form-label">Результат:</label>
                                            <div class="code-block">
                                                <pre x-text="JSON.stringify(testResult, null, 2)"></pre>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="card">
                                    <div class="card-header">
                                        <i class="fas fa-chart-bar me-2"></i>Метрики качества
                                    </div>
                                    <div class="card-body">
                                        <template x-if="trainingResult">
                                            <div>
                                                <div class="row text-center mb-3">
                                                    <div class="col-4">
                                                        <div class="fw-bold text-success" x-text="(1 - trainingResult.error).toFixed(4)"></div>
                                                        <small class="text-muted">Точность</small>
                                                    </div>
                                                    <div class="col-4">
                                                        <div class="fw-bold text-primary" x-text="trainingResult.iterations"></div>
                                                        <small class="text-muted">Итерации</small>
                                                    </div>
                                                    <div class="col-4">
                                                        <div class="fw-bold text-info" x-text="trainingResult.time"></div>
                                                        <small class="text-muted">Время (с)</small>
                                                    </div>
                                                </div>
                                                
                                                <div class="mt-3">
                                                    <h6>Оценка модели:</h6>
                                                    <div class="progress mb-2" style="height: 10px;">
                                                        <div class="progress-bar bg-success" role="progressbar" 
                                                             :style="`width: ${(1 - trainingResult.error) * 100}%`"></div>
                                                    </div>
                                                    <div class="text-center">
                                                        <span class="badge" 
                                                              :class="trainingResult.error < 0.01 ? 'bg-success' : trainingResult.error < 0.05 ? 'bg-warning' : 'bg-danger'"
                                                              x-text="trainingResult.error < 0.01 ? 'Отлично' : trainingResult.error < 0.05 ? 'Хорошо' : 'Требует доработки'"></span>
                                                    </div>
                                                </div>
                                            </div>
                                        </template>
                                        <template x-if="!trainingResult">
                                            <p class="text-muted mb-0">Сначала обучите модель</p>
                                        </template>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="col-lg-6">
                                <div class="card h-100">
                                    <div class="card-header">
                                        <i class="fas fa-code me-2"></i>Код модели
                                    </div>
                                    <div class="card-body p-0">
                                        <div class="code-block h-100">
                                            <pre x-text="generateModelCode()"></pre>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <script>
        function mlApp() {
            return {
                // Состояние приложения
                currentStep: 0,
                steps: [
                    { title: 'Тип сети', icon: 'fa-network-wired' },
                    { title: 'Конфигурация', icon: 'fa-sliders-h' },
                    { title: 'Данные', icon: 'fa-database' },
                    { title: 'Обучение', icon: 'fa-graduation-cap' },
                    { title: 'Результаты', icon: 'fa-chart-bar' }
                ],
                
                // Типы нейронных сетей
                networkTypes: [
                    {
                        id: 'neural-network',
                        name: 'Neural Network',
                        category: 'Feedforward',
                        complexity: 'Начальный',
                        description: 'Базовая feedforward нейронная сеть с обратным распространением ошибки',
                        longDescription: 'Классическая многослойная нейронная сеть прямого распространения. Идеально подходит для задач классификации и регрессии с числовыми данными.',
                        useCases: ['Классификация изображений', 'Прогнозирование числовых значений', 'Распознавание паттернов'],
                        features: ['Быстрая обучение', 'Простая архитектура', 'Хорошая интерпретируемость']
                    },
                    {
                        id: 'neural-network-gpu',
                        name: 'Neural Network GPU',
                        category: 'Feedforward',
                        complexity: 'Начальный',
                        description: 'Тот же функционал, но с GPU ускорением для больших наборов данных',
                        longDescription: 'GPU-ускоренная версия feedforward нейронной сети. Обеспечивает значительное ускорение обучения на больших наборах данных за счет использования графического процессора.',
                        useCases: ['Большие наборы данных', 'Сложные архитектуры', 'Быстрое прототипирование'],
                        features: ['GPU ускорение', 'Высокая производительность', 'Поддержка больших моделей']
                    },
                    {
                        id: 'rnn',
                        name: 'RNN',
                        category: 'Recurrent',
                        complexity: 'Продвинутый',
                        description: 'Рекуррентная нейронная сеть для последовательностей данных',
                        longDescription: 'Рекуррентные нейронные сети предназначены для работы с последовательными данными, где порядок имеет значение. Они имеют "память" о предыдущих элементах последовательности.',
                        useCases: ['Анализ временных рядов', 'Обработка естественного языка', 'Распознавание речи'],
                        features: ['Работа с последовательностями', 'Внутренняя память', 'Обработка данных переменной длины']
                    },
                    {
                        id: 'lstm',
                        name: 'LSTM',
                        category: 'Recurrent',
                        complexity: 'Продвинутый',
                        description: 'Долгая краткосрочная память для сложных последовательностей',
                        longDescription: 'LSTM - это особый тип рекуррентной нейронной сети, способный обучаться долгосрочным зависимостям. Имеет механизмы "вентилей" для контроля потока информации.',
                        useCases: ['Машинный перевод', 'Генерация текста', 'Прогнозирование временных рядов'],
                        features: ['Долгосрочная память', 'Устойчивость к затуханию градиента', 'Сложные последовательности']
                    },
                    {
                        id: 'gru',
                        name: 'GRU',
                        category: 'Recurrent',
                        complexity: 'Продвинутый',
                        description: 'Gated Recurrent Unit - упрощенная версия LSTM',
                        longDescription: 'GRU - это упрощенная версия LSTM с меньшим количеством параметров. Сохраняет способность обучаться долгосрочным зависимостям, но обучается быстрее.',
                        useCases: ['Анализ тональности', 'Автодополнение текста', 'Классификация последовательностей'],
                        features: ['Меньше параметров', 'Быстрее обучение', 'Сопоставимая с LSTM производительность']
                    },
                    {
                        id: 'rnn-time-step',
                        name: 'RNN Time Step',
                        category: 'Time Series',
                        complexity: 'Средний',
                        description: 'RNN для прогнозирования временных рядов',
                        longDescription: 'Специализированная версия RNN, оптимизированная для работы с временными рядами. Может предсказывать следующие значения в последовательности.',
                        useCases: ['Прогнозирование акций', 'Предсказание погоды', 'Анализ сенсорных данных'],
                        features: ['Прогнозирование временных рядов', 'Работа с числовыми последовательностями', 'Многовариантное прогнозирование']
                    },
                    {
                        id: 'lstm-time-step',
                        name: 'LSTM Time Step',
                        category: 'Time Series',
                        complexity: 'Продвинутый',
                        description: 'LSTM для сложных временных рядов',
                        longDescription: 'LSTM, специализированная для анализа временных рядов. Эффективна для данных с долгосрочными зависимостями и сезонными паттернами.',
                        useCases: ['Энергопотребление', 'Финансовые прогнозы', 'Медицинские данные'],
                        features: ['Сезонные паттерны', 'Долгосрочные зависимости', 'Шумоподавление']
                    },
                    {
                        id: 'ae',
                        name: 'Autoencoder',
                        category: 'Unsupervised',
                        complexity: 'Продвинутый',
                        description: 'Автоэнкодер для сжатия данных и поиска аномалий',
                        longDescription: 'Автоэнкодеры - это нейронные сети, которые учатся сжимать и восстанавливать данные. Состоят из энкодера (сжатие) и декодера (восстановление).',
                        useCases: ['Снижение размерности', 'Обнаружение аномалий', 'Шумоподавление'],
                        features: ['Неrequire размеченных данных', 'Сжатие данных', 'Выявление скрытых паттернов']
                    }
                ],
                
                // Выбранный тип сети
                selectedNetworkType: {},
                
                // Конфигурация модели
                modelConfig: {
                    inputSize: 2,
                    outputSize: 1,
                    hiddenLayers: [3],
                    activation: 'sigmoid'
                },
                
                // Конфигурация обучения
                trainingConfig: {
                    iterations: 2000,
                    errorThresh: 0.005,
                    learningRate: 0.3,
                    momentum: 0.1,
                    log: true
                },
                
                // Данные для обучения
                trainingData: [],
                manualDataInput: '',
                
                // Состояние обучения
                trainingStatus: 'idle', // 'idle', 'training', 'paused', 'completed'
                trainingProgress: 0,
                currentIteration: 0,
                currentError: 0,
                trainingTime: 0,
                trainingResult: null,
                trainingLogs: [],
                trainedModel: null,
                
                // Тестирование
                testInput: '',
                testResult: null,
                
                // Инициализация приложения
                init() {
                    this.selectNetworkType(this.networkTypes[0]);
                    this.initErrorChart();
                    this.addLog('Приложение инициализировано');
                },
                
                // Выбор типа сети
                selectNetworkType(network) {
                    this.selectedNetworkType = network;
                    this.addLog(`Выбран тип сети: ${network.name}`);
                },
                
                // Добавление скрытого слоя
                addHiddenLayer() {
                    this.modelConfig.hiddenLayers.push(3);
                },
                
                // Удаление скрытого слоя
                removeHiddenLayer() {
                    if (this.modelConfig.hiddenLayers.length > 1) {
                        this.modelConfig.hiddenLayers.pop();
                    }
                },
                
                // Загрузка примера данных
                showSampleData() {
                    this.manualDataInput = JSON.stringify([
                        { input: [0, 0], output: [0] },
                        { input: [0, 1], output: [1] },
                        { input: [1, 0], output: [1] },
                        { input: [1, 1], output: [0] }
                    ], null, 2);
                    this.parseData();
                    this.addLog('Загружены примеры данных (XOR)');
                },
                
                // Обработка загрузки файла
                handleFileUpload(event) {
                    const file = event.target.files[0];
                    if (!file) return;
                    
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        const content = e.target.result;
                        if (file.name.endsWith('.csv')) {
                            this.parseCSV(content);
                        } else if (file.name.endsWith('.json')) {
                            this.manualDataInput = content;
                            this.parseData();
                        }
                    };
                    reader.readAsText(file);
                },
                
                // Парсинг CSV
                parseCSV(csvText) {
                    const lines = csvText.split('\n');
                    const headers = lines[0].split(',');
                    
                    const data = [];
                    for (let i = 1; i < lines.length; i++) {
                        if (lines[i].trim() === '') continue;
                        
                        const values = lines[i].split(',');
                        const input = [];
                        const output = [];
                        
                        // Простая логика: последний столбец - выход, остальные - входы
                        for (let j = 0; j < values.length - 1; j++) {
                            input.push(parseFloat(values[j]));
                        }
                        output.push(parseFloat(values[values.length - 1]));
                        
                        data.push({ input, output });
                    }
                    
                    this.trainingData = data;
                    this.addLog(`Загружено ${data.length} записей из CSV`);
                },
                
                // Парсинг данных из текстового поля
                parseData() {
                    try {
                        const data = JSON.parse(this.manualDataInput);
                        if (Array.isArray(data)) {
                            this.trainingData = data;
                            this.addLog(`Загружено ${data.length} записей`);
                        } else {
                            alert('Данные должны быть массивом объектов');
                        }
                    } catch (e) {
                        alert('Ошибка парсинга JSON: ' + e.message);
                    }
                },
                
                // Автоподготовка данных
                preprocessData() {
                    // Простая нормализация данных
                    this.trainingData.forEach(item => {
                        // Нормализация входов
                        if (Array.isArray(item.input)) {
                            const max = Math.max(...item.input);
                            if (max > 1) {
                                item.input = item.input.map(val => val / max);
                            }
                        }
                        
                        // Нормализация выходов
                        if (Array.isArray(item.output)) {
                            const max = Math.max(...item.output);
                            if (max > 1) {
                                item.output = item.output.map(val => val / max);
                            }
                        }
                    });
                    
                    this.addLog('Данные автоматически подготовлены (нормализация)');
                },
                
                // Получение информации о данных
                getInputSize() {
                    if (this.trainingData.length === 0) return 0;
                    const firstItem = this.trainingData[0];
                    if (Array.isArray(firstItem.input)) {
                        return firstItem.input.length;
                    } else if (typeof firstItem.input === 'object') {
                        return Object.keys(firstItem.input).length;
                    }
                    return 1;
                },
                
                getOutputSize() {
                    if (this.trainingData.length === 0) return 0;
                    const firstItem = this.trainingData[0];
                    if (Array.isArray(firstItem.output)) {
                        return firstItem.output.length;
                    } else if (typeof firstItem.output === 'object') {
                        return Object.keys(firstItem.output).length;
                    }
                    return 1;
                },
                
                getDataType() {
                    if (this.trainingData.length === 0) return 'Неизвестно';
                    const firstItem = this.trainingData[0];
                    if (Array.isArray(firstItem.input)) {
                        return 'Массив чисел';
                    } else if (typeof firstItem.input === 'object') {
                        return 'Объект';
                    }
                    return 'Число';
                },
                
                getProblemType() {
                    if (this.trainingData.length === 0) return 'Неизвестно';
                    const firstOutput = this.trainingData[0].output;
                    
                    if (Array.isArray(firstOutput)) {
                        // Если выходы - это массивы с 0 и 1 (one-hot encoding)
                        if (firstOutput.length > 1 && firstOutput.includes(1)) {
                            return 'Многоклассовая классификация';
                        }
                        // Если один выход с 0/1
                        if (firstOutput.length === 1 && (firstOutput[0] === 0 || firstOutput[0] === 1)) {
                            return 'Бинарная классификация';
                        }
                    }
                    
                    return 'Регрессия';
                },
                
                // Инициализация графика ошибок
                initErrorChart() {
                    const svg = d3.select("#errorChart")
                        .append("svg")
                        .attr("width", "100%")
                        .attr("height", "300");
                    
                    // Пока просто создаем SVG, данные добавим позже
                },
                
                // Обновление графика ошибок
                updateErrorChart(errorData) {
                    const margin = { top: 20, right: 30, bottom: 30, left: 40 };
                    const width = 600 - margin.left - margin.right;
                    const height = 250 - margin.top - margin.bottom;
                    
                    d3.select("#errorChart svg").remove();
                    
                    const svg = d3.select("#errorChart")
                        .append("svg")
                        .attr("width", width + margin.left + margin.right)
                        .attr("height", height + margin.top + margin.bottom)
                        .append("g")
                        .attr("transform", `translate(${margin.left},${margin.top})`);
                    
                    // Шкалы
                    const x = d3.scaleLinear()
                        .domain([0, errorData.length - 1])
                        .range([0, width]);
                    
                    const y = d3.scaleLinear()
                        .domain([0, d3.max(errorData)])
                        .range([height, 0]);
                    
                    // Линия
                    const line = d3.line()
                        .x((d, i) => x(i))
                        .y(d => y(d))
                        .curve(d3.curveMonotoneX);
                    
                    // Оси
                    svg.append("g")
                        .attr("transform", `translate(0,${height})`)
                        .call(d3.axisBottom(x));
                    
                    svg.append("g")
                        .call(d3.axisLeft(y));
                    
                    // Путь
                    svg.append("path")
                        .datum(errorData)
                        .attr("fill", "none")
                        .attr("stroke", "#4361ee")
                        .attr("stroke-width", 1.5)
                        .attr("d", line);
                },
                
                // Начало обучения
                startTraining() {
                    if (this.trainingData.length === 0) {
                        alert('Сначала загрузите данные для обучения');
                        return;
                    }
                    
                    this.trainingStatus = 'training';
                    this.trainingProgress = 0;
                    this.currentIteration = 0;
                    this.currentError = 0;
                    this.trainingTime = 0;
                    this.trainingLogs = [];
                    this.trainedModel = null;
                    
                    this.addLog('Начало обучения модели');
                    
                    // Имитация процесса обучения
                    this.simulateTraining();
                },
                
                // Имитация обучения (в реальном приложении здесь будет вызов Brain.js)
                simulateTraining() {
                    const startTime = Date.now();
                    const errorData = [];
                    
                    const interval = setInterval(() => {
                        if (this.trainingStatus !== 'training') {
                            clearInterval(interval);
                            return;
                        }
                        
                        this.currentIteration += 10;
                        this.currentError = Math.max(0.001, 0.5 * Math.exp(-this.currentIteration / 500));
                        errorData.push(this.currentError);
                        
                        this.trainingProgress = Math.min(100, (this.currentIteration / this.trainingConfig.iterations) * 100);
                        this.trainingTime = ((Date.now() - startTime) / 1000).toFixed(2);
                        
                        if (this.currentIteration % 100 === 0) {
                            this.addLog(`Итерация ${this.currentIteration}, ошибка: ${this.currentError.toFixed(6)}`);
                        }
                        
                        // Обновляем график каждые 50 итераций
                        if (this.currentIteration % 50 === 0) {
                            this.updateErrorChart(errorData);
                        }
                        
                        // Завершение обучения
                        if (this.currentIteration >= this.trainingConfig.iterations || 
                            this.currentError <= this.trainingConfig.errorThresh) {
                            clearInterval(interval);
                            this.trainingStatus = 'completed';
                            this.trainingProgress = 100;
                            
                            this.trainingResult = {
                                iterations: this.currentIteration,
                                error: this.currentError,
                                time: this.trainingTime
                            };
                            
                            // Создаем простую модель для демонстрации
                            this.trainedModel = {
                                run: (input) => {
                                    // Простая имитация XOR
                                    if (Array.isArray(input) && input.length === 2) {
                                        const [a, b] = input;
                                        return [a ^ b]; // XOR операция
                                    }
                                    return [Math.random()];
                                }
                            };
                            
                            this.addLog(`Обучение завершено! Итерации: ${this.currentIteration}, Ошибка: ${this.currentError.toFixed(6)}`);
                        }
                    }, 50);
                },
                
                // Пауза обучения
                pauseTraining() {
                    this.trainingStatus = 'paused';
                    this.addLog('Обучение приостановлено');
                },
                
                // Остановка обучения
                stopTraining() {
                    this.trainingStatus = 'idle';
                    this.addLog('Обучение остановлено');
                },
                
                // Запуск теста
                runTest() {
                    if (!this.trainedModel) {
                        alert('Сначала обучите модель');
                        return;
                    }
                    
                    try {
                        const input = JSON.parse(this.testInput);
                        this.testResult = this.trainedModel.run(input);
                        this.addLog(`Выполнен тест с входными данными: ${this.testInput}`);
                    } catch (e) {
                        alert('Ошибка парсинга входных данных: ' + e.message);
                    }
                },
                
                // Загрузка примера теста
                loadExampleTest() {
                    this.testInput = '[0, 1]';
                },
                
                // Генерация кода модели
                generateModelCode() {
                    return `// Код для Brain.js
const net = new brain.${this.getNetworkConstructor()}(${JSON.stringify(this.modelConfig, null, 2)});

const trainingData = ${JSON.stringify(this.trainingData, null, 2)};

net.train(trainingData, ${JSON.stringify(this.trainingConfig, null, 2)});

// Использование модели
const output = net.run([0, 1]);
console.log(output);`;
                },
                
                // Получение конструктора сети
                getNetworkConstructor() {
                    const mapping = {
                        'neural-network': 'NeuralNetwork',
                        'neural-network-gpu': 'NeuralNetworkGPU',
                        'rnn': 'recurrent.RNN',
                        'lstm': 'recurrent.LSTM',
                        'gru': 'recurrent.GRU',
                        'rnn-time-step': 'recurrent.RNNTimeStep',
                        'lstm-time-step': 'recurrent.LSTMTimeStep',
                        'ae': 'Autoencoder'
                    };
                    
                    return mapping[this.selectedNetworkType.id] || 'NeuralNetwork';
                },
                
                // Добавление лога
                addLog(message) {
                    this.trainingLogs.unshift({
                        id: Date.now(),
                        message: message,
                        timestamp: new Date().toLocaleTimeString()
                    });
                    
                    // Ограничиваем количество логов
                    if (this.trainingLogs.length > 50) {
                        this.trainingLogs.pop();
                    }
                },
                
                // Экспорт модели
                exportModel() {
                    const modelData = {
                        type: this.selectedNetworkType.id,
                        config: this.modelConfig,
                        training: this.trainingResult,
                        data: this.trainingData
                    };
                    
                    const dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(modelData, null, 2));
                    const downloadAnchorNode = document.createElement('a');
                    downloadAnchorNode.setAttribute("href", dataStr);
                    downloadAnchorNode.setAttribute("download", "brainjs-model.json");
                    document.body.appendChild(downloadAnchorNode);
                    downloadAnchorNode.click();
                    downloadAnchorNode.remove();
                    
                    this.addLog('Модель экспортирована в JSON');
                },
                
                // Экспорт кода
                exportCode() {
                    const code = this.generateModelCode();
                    const dataStr = "data:text/javascript;charset=utf-8," + encodeURIComponent(code);
                    const downloadAnchorNode = document.createElement('a');
                    downloadAnchorNode.setAttribute("href", dataStr);
                    downloadAnchorNode.setAttribute("download", "brainjs-model.js");
                    document.body.appendChild(downloadAnchorNode);
                    downloadAnchorNode.click();
                    downloadAnchorNode.remove();
                    
                    this.addLog('Код модели экспортирован');
                },
                
                // Экспорт результатов
                exportResults() {
                    const results = {
                        model: this.selectedNetworkType.name,
                        config: this.modelConfig,
                        training: this.trainingResult,
                        test: this.testResult
                    };
                    
                    const dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(results, null, 2));
                    const downloadAnchorNode = document.createElement('a');
                    downloadAnchorNode.setAttribute("href", dataStr);
                    downloadAnchorNode.setAttribute("download", "training-results.json");
                    document.body.appendChild(downloadAnchorNode);
                    downloadAnchorNode.click();
                    downloadAnchorNode.remove();
                    
                    this.addLog('Результаты обучения экспортированы');
                },
                
                // Сброс приложения
                resetApp() {
                    if (confirm('Вы уверены, что хотите сбросить все данные?')) {
                        this.currentStep = 0;
                        this.selectedNetworkType = this.networkTypes[0];
                        this.modelConfig = {
                            inputSize: 2,
                            outputSize: 1,
                            hiddenLayers: [3],
                            activation: 'sigmoid'
                        };
                        this.trainingConfig = {
                            iterations: 2000,
                            errorThresh: 0.005,
                            learningRate: 0.3,
                            momentum: 0.1,
                            log: true
                        };
                        this.trainingData = [];
                        this.manualDataInput = '';
                        this.trainingStatus = 'idle';
                        this.trainingProgress = 0;
                        this.currentIteration = 0;
                        this.currentError = 0;
                        this.trainingTime = 0;
                        this.trainingResult = null;
                        this.trainingLogs = [];
                        this.trainedModel = null;
                        this.testInput = '';
                        this.testResult = null;
                        
                        this.addLog('Приложение сброшено');
                    }
                }
            };
        }
    </script>
</body>
</html>
